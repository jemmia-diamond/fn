import { safeNumericValue, safeValue } from "src/services/utils/data-mappers";

export const mapSalesOrderToDatabase = (salesOrder) => {
  return {
    name: salesOrder?.name || null,
    owner: salesOrder?.owner || null,
    creation: salesOrder?.creation ? new Date(salesOrder.creation) : null,
    modified: salesOrder?.modified ? new Date(salesOrder.modified) : null,
    modified_by: salesOrder?.modified_by || null,
    docstatus: salesOrder?.docstatus || null,
    idx: salesOrder?.idx || null,
    
    // Order information
    title: salesOrder?.title || null,
    naming_series: salesOrder?.naming_series || null,
    tax_id: salesOrder?.tax_id || null,
    order_type: salesOrder?.order_type || null,
    skip_delivery_note: salesOrder?.skip_delivery_note || null,
    delivery_date: salesOrder?.delivery_date ? new Date(salesOrder.delivery_date) : null,
    po_no: salesOrder?.po_no || null,
    po_date: salesOrder?.po_date ? new Date(salesOrder.po_date) : null,
    company: salesOrder?.company || null,
    amended_from: salesOrder?.amended_from || null,
    
    // Customer information
    customer_name: salesOrder?.customer_name || null,
    order_number: salesOrder?.order_number || null,
    transaction_date: salesOrder?.transaction_date ? new Date(salesOrder.transaction_date) : null,
    real_order_date: salesOrder?.real_order_date ? new Date(salesOrder.real_order_date) : null,
    cancelled_status: salesOrder?.cancelled_status || null,
    financial_status: salesOrder?.financial_status || null,
    fulfillment_status: salesOrder?.fulfillment_status || null,
    expected_delivery_date: salesOrder?.expected_delivery_date ? new Date(salesOrder.expected_delivery_date) : null,
    cost_center: salesOrder?.cost_center || null,
    project: salesOrder?.project || null,
    
    // Currency and pricing
    currency: salesOrder?.currency || null,
    conversion_rate: salesOrder?.conversion_rate || null,
    selling_price_list: salesOrder?.selling_price_list || null,
    price_list_currency: salesOrder?.price_list_currency || null,
    plc_conversion_rate: salesOrder?.plc_conversion_rate || null,
    ignore_pricing_rule: salesOrder?.ignore_pricing_rule || null,
    scan_barcode: salesOrder?.scan_barcode || null,
    set_warehouse: salesOrder?.set_warehouse || null,
    reserve_stock: salesOrder?.reserve_stock || null,
    
    // Discount and totals
    apply_discount_on: safeValue(salesOrder?.apply_discount_on),
    base_discount_amount: safeNumericValue(salesOrder?.base_discount_amount),
    coupon_code: safeValue(salesOrder?.coupon_code),
    additional_discount_percentage: safeNumericValue(salesOrder?.additional_discount_percentage),
    total_qty: safeNumericValue(salesOrder?.total_qty),
    total: safeNumericValue(salesOrder?.total),
    discount_amount: safeNumericValue(salesOrder?.discount_amount),
    grand_total: safeNumericValue(salesOrder?.grand_total),
    base_total: safeNumericValue(salesOrder?.base_total),
    base_net_total: safeNumericValue(salesOrder?.base_net_total),
    total_net_weight: safeNumericValue(salesOrder?.total_net_weight),
    net_total: safeNumericValue(salesOrder?.net_total),
    
    // Tax information
    tax_category: salesOrder?.tax_category || null,
    taxes_and_charges: salesOrder?.taxes_and_charges || null,
    shipping_rule: salesOrder?.shipping_rule || null,
    incoterm: salesOrder?.incoterm || null,
    named_place: salesOrder?.named_place || null,
    base_total_taxes_and_charges: safeNumericValue(salesOrder?.base_total_taxes_and_charges),
    total_taxes_and_charges: safeNumericValue(salesOrder?.total_taxes_and_charges),
    base_grand_total: safeNumericValue(salesOrder?.base_grand_total),
    base_rounding_adjustment: safeNumericValue(salesOrder?.base_rounding_adjustment),
    base_rounded_total: safeNumericValue(salesOrder?.base_rounded_total),
    base_in_words: safeValue(salesOrder?.base_in_words),
    rounding_adjustment: safeNumericValue(salesOrder?.rounding_adjustment),
    rounded_total: safeNumericValue(salesOrder?.rounded_total),
    in_words: safeValue(salesOrder?.in_words),
    advance_paid: safeNumericValue(salesOrder?.advance_paid),
    disable_rounded_total: salesOrder?.disable_rounded_total || null,
    other_charges_calculation: salesOrder?.other_charges_calculation || null,
    
    // Contact and address information
    contact_person: salesOrder?.contact_person || null,
    contact_display: salesOrder?.contact_display || null,
    contact_phone: salesOrder?.contact_phone || null,
    contact_mobile: salesOrder?.contact_mobile || null,
    contact_email: salesOrder?.contact_email || null,
    customer_address: salesOrder?.customer_address || null,
    address_display: salesOrder?.address_display || null,
    customer_group: salesOrder?.customer_group || null,
    territory: salesOrder?.territory || null,
    shipping_address_name: salesOrder?.shipping_address_name || null,
    shipping_address: salesOrder?.shipping_address || null,
    customer: salesOrder?.customer || null,
    gender: salesOrder?.gender || null,
    customer_type: salesOrder?.customer_type || null,
    customer_personal_id: salesOrder?.customer_personal_id || null,
    birth_date: salesOrder?.birth_date ? new Date(salesOrder.birth_date) : null,
    date_of_issuance: salesOrder?.date_of_issuance ? new Date(salesOrder.date_of_issuance) : null,
    dispatch_address: salesOrder?.dispatch_address || null,
    place_of_issuance: salesOrder?.place_of_issuance || null,
    dispatch_address_name: salesOrder?.dispatch_address_name || null,
    company_address: salesOrder?.company_address || null,
    company_address_display: salesOrder?.company_address_display || null,
    company_contact_person: salesOrder?.company_contact_person || null,
    
    // Status information
    status: salesOrder?.status || null,
    delivery_status: salesOrder?.delivery_status || null,
    per_delivered: salesOrder?.per_delivered || null,
    per_billed: salesOrder?.per_billed || null,
    per_picked: salesOrder?.per_picked || null,
    billing_status: salesOrder?.billing_status || null,
    
    // Sales and commission
    sales_partner: salesOrder?.sales_partner || null,
    amount_eligible_for_commission: safeNumericValue(salesOrder?.amount_eligible_for_commission),
    commission_rate: safeNumericValue(salesOrder?.commission_rate),
    total_commission: safeNumericValue(salesOrder?.total_commission),
    loyalty_points: salesOrder?.loyalty_points || null,
    loyalty_amount: safeNumericValue(salesOrder?.loyalty_amount),
    from_date: salesOrder?.from_date ? new Date(salesOrder.from_date) : null,
    to_date: salesOrder?.to_date ? new Date(salesOrder.to_date) : null,
    auto_repeat: salesOrder?.auto_repeat || null,
    
    // Print and display
    letter_head: salesOrder?.letter_head || null,
    group_same_items: salesOrder?.group_same_items || null,
    select_print_heading: salesOrder?.select_print_heading || null,
    language: salesOrder?.language || null,
    is_internal_customer: salesOrder?.is_internal_customer || null,
    represents_company: salesOrder?.represents_company || null,
    source: salesOrder?.source || null,
    inter_company_order_reference: salesOrder?.inter_company_order_reference || null,
    campaign: salesOrder?.campaign || null,
    party_account_currency: salesOrder?.party_account_currency || null,
    
    // Payment information
    total_amount: safeNumericValue(salesOrder?.total_amount),
    expected_payment_date: salesOrder?.expected_payment_date ? new Date(salesOrder.expected_payment_date) : null,
    paid_amount: safeNumericValue(salesOrder?.paid_amount),
    balance: safeNumericValue(salesOrder?.balance),
    payment_terms_template: salesOrder?.payment_terms_template || null,
    tc_name: salesOrder?.tc_name || null,
    terms: salesOrder?.terms || null,
    
    // Haravan integration
    haravan_order_id: salesOrder?.haravan_order_id || null,
    haravan_ref_order_id: salesOrder?.haravan_ref_order_id || null,
    haravan_created_at: salesOrder?.haravan_created_at ? new Date(salesOrder.haravan_created_at) : null,
    source_name: salesOrder?.source_name || null,
    
    // JSONB fields - Prisma will handle JSON conversion automatically
    sales_team: salesOrder?.sales_team || null,
    ref_sales_orders: salesOrder?.ref_sales_orders || null,
    promotions: salesOrder?.promotions || null,
    product_categories: salesOrder?.product_categories || null,
    packed_items: salesOrder?.packed_items || null,
    taxes: salesOrder?.taxes || null,
    pricing_rules: salesOrder?.pricing_rules || null,
    payment_records: salesOrder?.payment_records || null,
    payment_schedule: salesOrder?.payment_schedule || null,
    policies: salesOrder?.policies || null,
    items: salesOrder?.items || null
  };
};

export const mapSalesOrderItemToDatabase = (salesOrderItem) => {
  return ({
    name: salesOrderItem?.name || null,
    owner: salesOrderItem?.owner || null,
    creation: salesOrderItem?.creation ? new Date(salesOrderItem.creation) : null,
    modified: salesOrderItem?.modified ? new Date(salesOrderItem.modified) : null,
    modified_by: salesOrderItem?.modified_by || null,
    docstatus: salesOrderItem?.docstatus || null,
    idx: salesOrderItem?.idx || null,
    item_name: salesOrderItem?.item_name || null,
    variant_title: salesOrderItem?.variant_title || null,
    sku: salesOrderItem?.sku || null,
    barcode: salesOrderItem?.barcode || null,
    haravan_variant_id: salesOrderItem?.haravan_variant_id || null,
    ensure_delivery_based_on_produced_serial_no: salesOrderItem?.ensure_delivery_based_on_produced_serial_no || null,
    is_stock_item: salesOrderItem?.is_stock_item || null,
    reserve_stock: salesOrderItem?.reserve_stock || null,
    qty: safeNumericValue(salesOrderItem?.qty),
    stock_uom: safeValue(salesOrderItem?.stock_uom),
    uom: safeValue(salesOrderItem?.uom),
    conversion_factor: safeNumericValue(salesOrderItem?.conversion_factor),
    stock_qty: safeNumericValue(salesOrderItem?.stock_qty),
    stock_reserved_qty: safeNumericValue(salesOrderItem?.stock_reserved_qty),
    price_list_rate: safeNumericValue(salesOrderItem?.price_list_rate),
    base_price_list_rate: safeNumericValue(salesOrderItem?.base_price_list_rate),
    discount_percentage: safeNumericValue(salesOrderItem?.discount_percentage),
    discount_amount: safeNumericValue(salesOrderItem?.discount_amount),
    distributed_discount_amount: safeNumericValue(salesOrderItem?.distributed_discount_amount),
    base_rate_with_margin: safeNumericValue(salesOrderItem?.base_rate_with_margin),
    margin_type: safeValue(salesOrderItem?.margin_type),
    margin_rate_or_amount: safeNumericValue(salesOrderItem?.margin_rate_or_amount),
    rate_with_margin: safeNumericValue(salesOrderItem?.rate_with_margin),
    rate: safeNumericValue(salesOrderItem?.rate),
    amount: safeNumericValue(salesOrderItem?.amount),
    base_rate: safeNumericValue(salesOrderItem?.base_rate),
    base_amount: safeNumericValue(salesOrderItem?.base_amount),
    stock_uom_rate: safeNumericValue(salesOrderItem?.stock_uom_rate),
    is_free_item: salesOrderItem?.is_free_item || null,
    grant_commission: salesOrderItem?.grant_commission || null,
    net_rate: safeNumericValue(salesOrderItem?.net_rate),
    net_amount: safeNumericValue(salesOrderItem?.net_amount),
    base_net_rate: safeNumericValue(salesOrderItem?.base_net_rate),
    base_net_amount: safeNumericValue(salesOrderItem?.base_net_amount),
    billed_amt: safeNumericValue(salesOrderItem?.billed_amt),
    valuation_rate: safeNumericValue(salesOrderItem?.valuation_rate),
    gross_profit: safeNumericValue(salesOrderItem?.gross_profit),
    delivered_by_supplier: salesOrderItem?.delivered_by_supplier || null,
    weight_per_unit: safeNumericValue(salesOrderItem?.weight_per_unit),
    total_weight: safeNumericValue(salesOrderItem?.total_weight),
    against_blanket_order: safeValue(salesOrderItem?.against_blanket_order),
    blanket_order_rate: safeNumericValue(salesOrderItem?.blanket_order_rate),
    actual_qty: safeNumericValue(salesOrderItem?.actual_qty),
    company_total_stock: safeNumericValue(salesOrderItem?.company_total_stock),
    projected_qty: safeNumericValue(salesOrderItem?.projected_qty),
    ordered_qty: safeNumericValue(salesOrderItem?.ordered_qty),
    planned_qty: safeNumericValue(salesOrderItem?.planned_qty),
    production_plan_qty: safeNumericValue(salesOrderItem?.production_plan_qty),
    work_order_qty: safeNumericValue(salesOrderItem?.work_order_qty),
    delivered_qty: safeNumericValue(salesOrderItem?.delivered_qty),
    produced_qty: safeNumericValue(salesOrderItem?.produced_qty),
    returned_qty: safeNumericValue(salesOrderItem?.returned_qty),
    picked_qty: safeNumericValue(salesOrderItem?.picked_qty),
    page_break: safeValue(salesOrderItem?.page_break),
    item_tax_rate: safeValue(salesOrderItem?.item_tax_rate),
    transaction_date: salesOrderItem?.transaction_date ? new Date(salesOrderItem.transaction_date) : null,
    cost_center: safeValue(salesOrderItem?.cost_center),
    parent: safeValue(salesOrderItem?.parent),
    parentfield: safeValue(salesOrderItem?.parentfield),
    parenttype: safeValue(salesOrderItem?.parenttype),
    doctype: safeValue(salesOrderItem?.doctype)
  });
};

export const mapSalesTeamToDatabase = (salesTeam) => {
  return ({
    name: safeValue(salesTeam?.name),
    owner: safeValue(salesTeam?.owner),
    creation: salesTeam?.creation ? new Date(salesTeam.creation) : null,
    modified: salesTeam?.modified ? new Date(salesTeam.modified) : null,
    modified_by: safeValue(salesTeam?.modified_by),
    docstatus: safeNumericValue(salesTeam?.docstatus),
    idx: safeNumericValue(salesTeam?.idx),
    allocated_amount: safeNumericValue(salesTeam?.allocated_amount),
    allocated_percentage: safeNumericValue(salesTeam?.allocated_percentage),
    commission_rate: safeValue(salesTeam?.commission_rate),
    incentive: safeNumericValue(salesTeam?.incentive),
    parentfield: safeValue(salesTeam?.parentfield),
    parent: safeValue(salesTeam?.parent),
    parenttype: safeValue(salesTeam?.parenttype),
    sales_person: safeValue(salesTeam?.sales_person)
  });
};
